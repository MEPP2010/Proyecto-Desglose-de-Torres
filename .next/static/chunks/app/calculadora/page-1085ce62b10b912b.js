(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[281],{1841:function(e,a,t){Promise.resolve().then(t.bind(t,5376))},5376:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return r}});var s=t(7437),l=t(2265),n=t(7648);function r(){let[e,a]=(0,l.useState)({tipo:"",fabricante:"",cabeza:""}),[t,r]=(0,l.useState)({TIPO:[],FABRICANTE:[],CABEZA:[],PARTE_DIVISION:[]}),[o,d]=(0,l.useState)({}),[p,x]=(0,l.useState)([]),[u,m]=(0,l.useState)({total_pieces:0,total_weight:0}),[f,h]=(0,l.useState)(!1),[b,g]=(0,l.useState)(""),[j,N]=(0,l.useState)("Selecciona TIPO y FABRICANTE para ver las partes disponibles...");(0,l.useEffect)(()=>{v()},[]),(0,l.useEffect)(()=>{e.tipo&&e.fabricante?0===t.PARTE_DIVISION.length?N("No hay partes disponibles para esta configuraci\xf3n. Revisa los filtros."):N(""):(N("Selecciona TIPO y FABRICANTE para ver las partes disponibles..."),d({}))},[e.tipo,e.fabricante,t.PARTE_DIVISION]);let v=async()=>{try{let a=new URLSearchParams;e.tipo&&a.append("TIPO",e.tipo),e.fabricante&&a.append("FABRICANTE",e.fabricante),e.cabeza&&a.append("CABEZA",e.cabeza);let t=await fetch("/api/options?".concat(a)),s=await t.json();if(s.success&&(r(s.options),e.tipo&&e.fabricante&&s.options.PARTE_DIVISION)){let e={};s.options.PARTE_DIVISION.forEach(a=>{e[a]={part:a,quantity:1,selected:!1}}),d(e)}}catch(e){console.error("Error loading options:",e)}},y=(e,t)=>{a(a=>({...a,[e]:t})),setTimeout(()=>v(),0)},C=e=>{d(a=>({...a,[e]:{...a[e],selected:!a[e].selected}}))},D=(e,a)=>{d(t=>({...t,[e]:{...t[e],quantity:Math.max(1,a)}}))},E=async()=>{let a=Object.values(o).filter(e=>e.selected);if(0===a.length){w("⚠️ Por favor selecciona al menos una parte de la torre");return}if(!e.tipo||!e.fabricante){w("⚠️ Por favor completa al menos TIPO Y FABRICANTE");return}h(!0),g("⏳ Calculando materiales...");try{let t=await fetch("/api/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:e,parts:a.map(e=>({part:e.part,quantity:e.quantity}))})}),s=await t.json();s.success?(x(s.results),m(s.totals),g("✅ ".concat(s.results.length," piezas diferentes encontradas"))):g("❌ Error: ".concat(s.message))}catch(e){g("\uD83D\uDEA8 Error: ".concat(e instanceof Error?e.message:"Error desconocido"))}},w=e=>{alert(e)};return(0,s.jsx)("div",{className:"min-h-screen p-5",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:(0,s.jsxs)("div",{className:"max-w-[1600px] mx-auto bg-white p-8 rounded-xl shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-[#2c3e50] mb-2",children:"\uD83D\uDD27 Calculadora de Materiales - Torres"}),(0,s.jsx)("p",{className:"text-[#7f8c8d] text-sm",children:"Selecciona las partes de la torre que necesitas y calcula autom\xe1ticamente los materiales requeridos"})]}),(0,s.jsx)(n.default,{href:"/",className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold",children:"← Volver al Buscador"})]}),(0,s.jsxs)("div",{className:"bg-[#f8f9fa] p-5 rounded-lg border-2 border-[#e9ecef] mb-6",children:[(0,s.jsx)("div",{className:"text-xl font-bold text-[#495057] mb-4 flex items-center gap-2",children:"\uD83D\uDCCB Configuraci\xf3n de Torre"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-5",children:[(0,s.jsx)(i,{label:"TIPO:",value:e.tipo,options:t.TIPO,onChange:e=>y("tipo",e)}),(0,s.jsx)(i,{label:"FABRICANTE:",value:e.fabricante,options:t.FABRICANTE,onChange:e=>y("fabricante",e)}),(0,s.jsx)(i,{label:"CABEZA:",value:e.cabeza,options:t.CABEZA,onChange:e=>y("cabeza",e)})]}),(0,s.jsx)("div",{className:"text-xl font-bold text-[#495057] mb-4 mt-6 flex items-center gap-2",children:"\uD83D\uDDDD️ Selecciona las Partes de la Torre"}),j?(0,s.jsx)("p",{className:"text-center text-[#6c757d] italic p-5 bg-[#f8f9fa] rounded-lg",children:j}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Object.values(o).map(e=>(0,s.jsx)(c,{part:e,onToggle:()=>C(e.part),onQuantityChange:a=>D(e.part,a)},e.part))}),(0,s.jsxs)("div",{className:"flex gap-4 mt-5 flex-wrap",children:[(0,s.jsx)("button",{onClick:E,className:"bg-gradient-to-r from-[#667eea] to-[#764ba2] text-white px-8 py-3 rounded-lg font-semibold hover:shadow-lg transition",children:"\uD83E\uDDEE Calcular Materiales"}),(0,s.jsx)("button",{onClick:()=>{a({tipo:"",fabricante:"",cabeza:""}),d({}),x([]),h(!1),setTimeout(()=>v(),0)},className:"bg-[#6c757d] hover:bg-[#5a6268] text-white px-8 py-3 rounded-lg font-semibold transition",children:"\uD83D\uDD04 Limpiar"})]})]}),f&&(0,s.jsxs)("div",{className:"mt-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 p-4 bg-[#f8f9fa] rounded-lg",children:[(0,s.jsx)("div",{className:"font-bold text-[#495057]",children:b}),(0,s.jsxs)("div",{className:"flex gap-5 text-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-[#6c757d] text-xs",children:"Total Piezas"}),(0,s.jsx)("span",{className:"font-bold text-[#667eea] text-xl",children:Math.round(u.total_pieces)})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-[#6c757d] text-xs",children:"Peso Total (kg)"}),(0,s.jsx)("span",{className:"font-bold text-[#667eea] text-xl",children:u.total_weight.toFixed(2)})]})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto rounded-lg border-2 border-[#dee2e6]",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gradient-to-r from-[#667eea] to-[#764ba2] text-white sticky top-0 z-10",children:(0,s.jsx)("tr",{children:["Material","Descripci\xf3n","Parte","Posici\xf3n","Cant. Original","Cant. Calculada","Peso Unit. (kg)","Peso Total (kg)","Long 2"].map(e=>(0,s.jsx)("th",{className:"px-3 py-3 text-left font-semibold",children:e},e))})}),(0,s.jsx)("tbody",{children:p.map((e,a)=>(0,s.jsxs)("tr",{className:"border-b border-[#e9ecef] hover:bg-[#f8f9fa]",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.id_item||"-"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.descripcion||"-"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.parte_division||"-"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.posicion||"-"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.cantidad_original}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("span",{className:"bg-[#fff3cd] text-[#856404] font-bold px-2 py-1 rounded",children:e.cantidad_calculada})}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.peso_unitario.toFixed(2)}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.peso_total.toFixed(2)}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.long_2_principal||"-"})]},a))})]})}),(0,s.jsxs)("div",{className:"mt-4 p-4 bg-[#e7f3ff] rounded-lg flex justify-between items-center",children:[(0,s.jsx)("span",{children:"\uD83D\uDCBE Exportar resultados para usar en tu proyecto"}),(0,s.jsx)("button",{onClick:()=>{if(0===p.length){w("⚠️ No hay datos para exportar");return}let e="Material,Descripci\xf3n,Parte,Posici\xf3n,Cant. Original,Cant. Calculada,Peso Unit.,Peso Total,Long 2\n";p.forEach(a=>{let t=[a.id_item||"-",a.descripcion||"-",a.parte_division||"-",a.posicion||"-",a.cantidad_original||0,a.cantidad_calculada||0,(a.peso_unitario||0).toFixed(2),(a.peso_total||0).toFixed(2),a.long_2_principal||"-"].map(e=>'"'.concat(e,'"')).join(",");e+=t+"\n"});let a=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="materiales_torre_".concat(Date.now(),".csv"),s.click()},className:"bg-[#28a745] hover:bg-[#218838] text-white px-6 py-2 rounded-lg font-semibold",children:"\uD83D\uDCE5 Exportar a CSV"})]})]})]})})}function i(e){let{label:a,value:t,options:l,onChange:n}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-semibold text-[#495057] mb-1 text-sm",children:a}),(0,s.jsxs)("select",{value:t,onChange:e=>n(e.target.value),className:"w-full p-2 border-2 border-[#dee2e6] rounded-md focus:border-[#667eea] focus:outline-none",children:[(0,s.jsxs)("option",{value:"",children:["Seleccionar ",a.replace(":","")]}),l.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})}function c(e){let{part:a,onToggle:t,onQuantityChange:l}=e;return(0,s.jsxs)("div",{onClick:t,className:"bg-white border-2 rounded-lg p-4 cursor-pointer transition hover:shadow-lg ".concat(a.selected?"border-[#667eea] bg-[#f0f3ff]":"border-[#dee2e6]"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:a.selected,onChange:t,className:"w-5 h-5",onClick:e=>e.stopPropagation()}),(0,s.jsx)("span",{className:"font-bold text-lg flex-1",children:a.part})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)("label",{className:"text-sm text-[#495057]",children:"Cantidad:"}),(0,s.jsx)("input",{type:"number",min:"1",value:a.quantity,disabled:!a.selected,onChange:e=>l(parseInt(e.target.value)||1),onClick:e=>e.stopPropagation(),className:"w-20 p-1 border-2 border-[#dee2e6] rounded text-center font-bold disabled:opacity-50"})]})]})}}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=1841)}),_N_E=e.O()}]);