"use strict";(()=>{var e={};e.id=137,e.ids=[137],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8984:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>P,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>A});var a={};r.r(a),r.d(a,{GET:()=>p});var o=r(9303),i=r(8716),n=r(670),s=r(7070),c=r(2914);async function p(e){try{let t=e.nextUrl.searchParams,r={TIPO:t.get("TIPO")||"",FABRICANTE:t.get("FABRICANTE")||"",CABEZA:t.get("CABEZA")||"",CUERPO:t.get("CUERPO")||"",TRAMO:t.get("TRAMO")||""},a=await (0,c.FW)(r);return s.NextResponse.json({success:!0,options:a})}catch(e){return console.error("Error al obtener opciones:",e),s.NextResponse.json({success:!1,message:"Error interno del servidor al obtener opciones."},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/options/route",pathname:"/api/options",filename:"route",bundlePath:"app/api/options/route"},resolvedPagePath:"D:\\Transelca - Martin Pinedo\\Proyecto-Desglose-de-Torres\\app\\api\\options\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:A,serverHooks:d}=l,f="/api/options/route";function P(){return(0,n.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:A})}},2914:(e,t,r)=>{r.d(t,{Nf:()=>A,FW:()=>l,tW:()=>u});let a=require("mongodb"),o=null,i=null;async function n(){if(!i){if(!process.env.MONGODB_URI)throw Error("MONGODB_URI must be set");o=new a.MongoClient(process.env.MONGODB_URI),await o.connect(),i=o.db("torres")}return i}function s(){return n().then(e=>e.collection("piezas"))}let c=new Set(["BGDA","BSUP","BMED","BINF","BDER","BIZQ","BSUP/MED"]),p=new Set(["PATA 0","PATA 0.0","PATA 1.5","PATA 3","PATA 3.0","PATA 4.5","PATA 6","PATA 6.0","PATA 7.5","PATA 9","PATA 9.0"]);async function l(e){let t=await s(),r={},a={TIPO:"tipo",FABRICANTE:"fabricante",CABEZA:"cabeza",CUERPO:"cuerpo",PARTE_DIVISION:"parte_division",TRAMO:"tramo"};for(let[o,i]of Object.entries(a)){let n={};for(let[t,r]of Object.entries(e))if(r&&t!==o){let e=a[t];e&&(n[e]=r)}let s=await t.distinct(i,{...n,[i]:{$ne:null,$ne:""}});r[o]=s.filter(e=>e&&"string"==typeof e).map(e=>e.trim()).sort()}return r}async function u(e){let t=await s(),r={};for(let[t,a]of Object.entries({tipo:"tipo",fabricante:"fabricante",cabeza:"cabeza",parte:"parte_division",cuerpo:"cuerpo",tramo:"tramo"}))e[t]&&("tramo"===t?r[a]=RegExp(`^${e[t]}$`,"i"):r[a]=e[t]);return await t.find(r).limit(500).toArray()}async function A(e,t){let r=await s(),a={};e.tipo&&(a.tipo=e.tipo),e.fabricante&&(a.fabricante=e.fabricante),e.cabeza&&(a.cabeza=e.cabeza);let o=await r.find(a).toArray(),i=[];for(let e of o){let r=(e.parte_division||"").trim().toUpperCase();if(!r)continue;let a=Number(e.cantidad_x_torre)||0,o=0;for(let e of t){let t=(e.part||"").trim().toUpperCase(),i=e.quantity||0;if(r===t){let e=c.has(r)||p.has(r);e&&1===a?o+=a*i:c.has(r)?o+=a*i/2:p.has(r)?o+=Math.ceil(a*i/4):e||(o+=a*i)}}if(o>0){let t=o*(Number(e.peso_unitario)||0);i.push({...e,cantidad_original:a,cantidad_calculada:o,peso_total:t})}}let n=i.reduce((e,t)=>e+t.cantidad_calculada,0),l=i.reduce((e,t)=>e+t.peso_total,0);return{results:i,totals:{total_pieces:n,total_weight:l}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(8984));module.exports=a})();