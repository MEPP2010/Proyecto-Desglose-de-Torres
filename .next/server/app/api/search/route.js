"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1835:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>A,patchFetch:()=>b,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d});var r={};a.r(r),a.d(r,{GET:()=>u});var o=a(9303),i=a(8716),n=a(670),s=a(7070),c=a(2914);async function u(e){try{let t=e.nextUrl.searchParams,a={tipo:t.get("tipo")||"",fabricante:t.get("fabricante")||"",cabeza:t.get("cabeza")||"",parte:t.get("parte")||"",cuerpo:t.get("cuerpo")||"",tramo:t.get("tramo")||""},r=await (0,c.tW)(a);return s.NextResponse.json({success:!0,count:r.length,results:r})}catch(e){return console.error("Error en la b\xfasqueda:",e),s.NextResponse.json({success:!1,message:"Error interno del servidor al buscar datos."},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"D:\\Transelca - Martin Pinedo\\Proyecto-Desglose-de-Torres\\app\\api\\search\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:f}=p,A="/api/search/route";function b(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},2914:(e,t,a)=>{a.d(t,{Nf:()=>d,FW:()=>p,tW:()=>l});let r=require("mongodb"),o=null,i=null;async function n(){if(!i){if(!process.env.MONGODB_URI)throw Error("MONGODB_URI must be set");o=new r.MongoClient(process.env.MONGODB_URI),await o.connect(),i=o.db("torres")}return i}function s(){return n().then(e=>e.collection("piezas"))}let c=new Set(["BGDA","BSUP","BMED","BINF","BDER","BIZQ","BSUP/MED"]),u=new Set(["PATA 0","PATA 0.0","PATA 1.5","PATA 3","PATA 3.0","PATA 4.5","PATA 6","PATA 6.0","PATA 7.5","PATA 9","PATA 9.0"]);async function p(e){let t=await s(),a={},r={TIPO:"tipo",FABRICANTE:"fabricante",CABEZA:"cabeza",CUERPO:"cuerpo",PARTE_DIVISION:"parte_division",TRAMO:"tramo"};for(let[o,i]of Object.entries(r)){let n={};for(let[t,a]of Object.entries(e))if(a&&t!==o){let e=r[t];e&&(n[e]=a)}let s=await t.distinct(i,{...n,[i]:{$ne:null,$ne:""}});a[o]=s.filter(e=>e&&"string"==typeof e).map(e=>e.trim()).sort()}return a}async function l(e){let t=await s(),a={};for(let[t,r]of Object.entries({tipo:"tipo",fabricante:"fabricante",cabeza:"cabeza",parte:"parte_division",cuerpo:"cuerpo",tramo:"tramo"}))e[t]&&("tramo"===t?a[r]=RegExp(`^${e[t]}$`,"i"):a[r]=e[t]);return await t.find(a).limit(500).toArray()}async function d(e,t){let a=await s(),r={};e.tipo&&(r.tipo=e.tipo),e.fabricante&&(r.fabricante=e.fabricante),e.cabeza&&(r.cabeza=e.cabeza);let o=await a.find(r).toArray(),i=[];for(let e of o){let a=(e.parte_division||"").trim().toUpperCase();if(!a)continue;let r=Number(e.cantidad_x_torre)||0,o=0;for(let e of t){let t=(e.part||"").trim().toUpperCase(),i=e.quantity||0;if(a===t){let e=c.has(a)||u.has(a);e&&1===r?o+=r*i:c.has(a)?o+=r*i/2:u.has(a)?o+=Math.ceil(r*i/4):e||(o+=r*i)}}if(o>0){let t=o*(Number(e.peso_unitario)||0);i.push({...e,cantidad_original:r,cantidad_calculada:o,peso_total:t})}}let n=i.reduce((e,t)=>e+t.cantidad_calculada,0),p=i.reduce((e,t)=>e+t.peso_total,0);return{results:i,totals:{total_pieces:n,total_weight:p}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(1835));module.exports=r})();